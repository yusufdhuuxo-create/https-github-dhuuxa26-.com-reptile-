{% extends "base.html" %}

{% block title %}Statistics - Activation Code Manager{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Statistics Dashboard</h1>
    <p>Track your activation code usage and performance</p>
</div>

<div class="grid grid-4">
    <div class="stat-card">
        <div class="stat-value">{{ stats.total }}</div>
        <div class="stat-label">Total Codes</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" style="color: var(--success);">{{ stats.active }}</div>
        <div class="stat-label">Active Codes</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" style="color: var(--warning);">{{ stats.used }}</div>
        <div class="stat-label">Used Codes</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" style="color: var(--danger);">{{ stats.inactive }}</div>
        <div class="stat-label">Inactive Codes</div>
    </div>
</div>

<div class="grid grid-2" style="margin-top: 1.5rem;">
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">&#128200; Today's Activity</h2>
        </div>
        <div class="grid grid-2">
            <div class="stat-card" style="box-shadow: none; background: var(--gray-50);">
                <div class="stat-value" style="font-size: 2rem;">{{ stats.generated_today }}</div>
                <div class="stat-label">Generated Today</div>
            </div>
            <div class="stat-card" style="box-shadow: none; background: var(--gray-50);">
                <div class="stat-value" style="font-size: 2rem;">{{ stats.used_today }}</div>
                <div class="stat-label">Used Today</div>
            </div>
        </div>
        <div style="margin-top: 1.5rem; padding: 1rem; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); border-radius: 12px; color: white; text-align: center;">
            <div style="font-size: 2rem; font-weight: 700;">{{ stats.usage_rate }}%</div>
            <div style="opacity: 0.9;">Overall Usage Rate</div>
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">&#128338; Recent Codes</h2>
        </div>
        {% if recent_codes %}
            {% for code in recent_codes %}
                <div style="padding: 0.75rem; border-bottom: 1px solid var(--gray-200); display: flex; justify-content: space-between; align-items: center;">
                    <code style="font-family: monospace; font-size: 0.875rem;">{{ code.code }}</code>
                    <span class="badge {{ 'badge-success' if code.is_active and not code.is_used else 'badge-gray' }}">
                        {% if code.is_used %}Used{% elif not code.is_active %}Inactive{% else %}Valid{% endif %}
                    </span>
                </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <p>No codes generated yet</p>
            </div>
        {% endif %}
    </div>
</div>

<div class="card" style="margin-top: 1.5rem;">
    <div class="card-header">
        <h2 class="card-title">&#9989; Recent Activations</h2>
    </div>
    {% if recent_activations %}
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Code</th>
                        <th>Used By</th>
                        <th>Activated At</th>
                        <th>Uses</th>
                    </tr>
                </thead>
                <tbody>
                    {% for code in recent_activations %}
                        <tr>
                            <td><code style="font-family: monospace;">{{ code.code }}</code></td>
                            <td>{{ code.used_by or 'Anonymous' }}</td>
                            <td>{{ code.used_at.strftime('%Y-%m-%d %H:%M') if code.used_at else '-' }}</td>
                            <td>{{ code.uses_count }} / {{ code.uses_allowed }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="empty-state">
            <div style="font-size: 3rem; margin-bottom: 1rem;">&#128269;</div>
            <p>No activations yet</p>
            <p style="font-size: 0.875rem; margin-top: 0.5rem;">Activated codes will appear here</p>
        </div>
    {% endif %}
</div>
{% endblock %}
