{% extends "base.html" %}

{% block title %}API Documentation - CodeVault{% endblock %}

{% block content %}
<div class="page-header">
    <h1>API Gateway</h1>
    <p>// Integration endpoints and documentation</p>
</div>

<div class="cyber-card animate-in">
    <div class="card-header">
        <h2 class="card-title">
            <span class="card-icon">◈</span>
            Access Token
        </h2>
    </div>
    {% if api_key %}
        <div style="background: var(--dark-4); padding: 1.25rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid var(--glass-border);">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                <code class="mono glow-text" style="font-size: 0.95rem; letter-spacing: 2px;">{{ api_key.key[:8] }}...{{ api_key.key[-8:] }}</code>
                <div style="display: flex; gap: 0.5rem;">
                    <button class="btn btn-secondary btn-sm" onclick="copyToClipboard('{{ api_key.key }}', this)">⧫ COPY</button>
                    <form method="POST" action="{{ url_for('regenerate_api_key') }}" style="display: inline;">
                        <button type="submit" class="btn btn-danger btn-sm">⟳ REGENERATE</button>
                    </form>
                </div>
            </div>
            <p style="color: var(--text-muted); font-size: 0.8rem; margin-top: 1rem; font-family: 'JetBrains Mono', monospace;">
                // Created: {{ api_key.created_at.strftime('%Y-%m-%d %H:%M UTC') }}
            </p>
        </div>
    {% else %}
        <form method="POST" action="{{ url_for('generate_api_key') }}">
            <button type="submit" class="btn btn-primary">◈ GENERATE ACCESS TOKEN</button>
        </form>
    {% endif %}
</div>

<div class="cyber-card animate-in" style="margin-top: 1.5rem; animation-delay: 0.1s;">
    <div class="card-header">
        <h2 class="card-title">
            <span class="card-icon">◎</span>
            Endpoints
        </h2>
    </div>
    
    <div style="display: flex; flex-direction: column; gap: 1.5rem;">
        <div style="background: var(--dark-4); padding: 1.5rem; border-radius: 8px; border-left: 3px solid var(--success);">
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                <span class="badge badge-success">POST</span>
                <code class="mono" style="color: var(--text-bright);">/api/validate</code>
            </div>
            <p style="color: var(--text-dim); margin-bottom: 1rem;">// Validate and activate an activation sequence</p>
            <div style="background: var(--dark-2); padding: 1rem; border-radius: 6px; margin-bottom: 1rem; border: 1px solid var(--glass-border);">
                <p style="color: var(--text-muted); font-size: 0.75rem; margin-bottom: 0.5rem; font-family: 'Orbitron', sans-serif; letter-spacing: 1px;">REQUEST BODY</p>
                <pre class="mono glow-text" style="font-size: 0.85rem; white-space: pre-wrap;">{
  "code": "PROMO-ABCD-EFGH",
  "user_name": "John Doe"  // optional
}</pre>
            </div>
            <div style="background: var(--dark-2); padding: 1rem; border-radius: 6px; border: 1px solid var(--glass-border);">
                <p style="color: var(--text-muted); font-size: 0.75rem; margin-bottom: 0.5rem; font-family: 'Orbitron', sans-serif; letter-spacing: 1px;">RESPONSE</p>
                <pre class="mono" style="color: var(--success); font-size: 0.85rem; white-space: pre-wrap;">{
  "valid": true,
  "message": "Code activated successfully!",
  "data": { ... }
}</pre>
            </div>
        </div>
        
        <div style="background: var(--dark-4); padding: 1.5rem; border-radius: 8px; border-left: 3px solid var(--info);">
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                <span class="badge badge-info">GET</span>
                <code class="mono" style="color: var(--text-bright);">/api/code/&lt;code&gt;/check</code>
            </div>
            <p style="color: var(--text-dim); margin-bottom: 1rem;">// Check code validity without activation</p>
            <div style="background: var(--dark-2); padding: 1rem; border-radius: 6px; border: 1px solid var(--glass-border);">
                <p style="color: var(--text-muted); font-size: 0.75rem; margin-bottom: 0.5rem; font-family: 'Orbitron', sans-serif; letter-spacing: 1px;">RESPONSE</p>
                <pre class="mono" style="color: var(--success); font-size: 0.85rem; white-space: pre-wrap;">{
  "exists": true,
  "valid": true,
  "message": "Code is valid",
  "uses_remaining": 1
}</pre>
            </div>
        </div>
        
        <div style="background: var(--dark-4); padding: 1.5rem; border-radius: 8px; border-left: 3px solid var(--info);">
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                <span class="badge badge-info">GET</span>
                <code class="mono" style="color: var(--text-bright);">/api/stats</code>
            </div>
            <p style="color: var(--text-dim); margin-bottom: 1rem;">// Retrieve system statistics</p>
            <div style="background: var(--dark-2); padding: 1rem; border-radius: 6px; border: 1px solid var(--glass-border);">
                <p style="color: var(--text-muted); font-size: 0.75rem; margin-bottom: 0.5rem; font-family: 'Orbitron', sans-serif; letter-spacing: 1px;">RESPONSE</p>
                <pre class="mono" style="color: var(--success); font-size: 0.85rem; white-space: pre-wrap;">{
  "total": 100,
  "active": 75,
  "used": 20,
  "inactive": 5,
  "usage_rate": 20.0
}</pre>
            </div>
        </div>
        
        <div style="background: var(--dark-4); padding: 1.5rem; border-radius: 8px; border-left: 3px solid var(--warning);">
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                <span class="badge badge-success">POST</span>
                <code class="mono" style="color: var(--text-bright);">/api/generate</code>
            </div>
            <p style="color: var(--text-dim); margin-bottom: 1rem;">// Generate new codes (requires API token)</p>
            <div style="background: var(--dark-2); padding: 1rem; border-radius: 6px; margin-bottom: 1rem; border: 1px solid rgba(255, 165, 2, 0.3);">
                <p style="color: var(--warning); font-size: 0.75rem; margin-bottom: 0.5rem; font-family: 'Orbitron', sans-serif; letter-spacing: 1px;">HEADERS</p>
                <pre class="mono" style="color: var(--warning); font-size: 0.85rem;">X-API-Key: your_access_token</pre>
            </div>
            <div style="background: var(--dark-2); padding: 1rem; border-radius: 6px; margin-bottom: 1rem; border: 1px solid var(--glass-border);">
                <p style="color: var(--text-muted); font-size: 0.75rem; margin-bottom: 0.5rem; font-family: 'Orbitron', sans-serif; letter-spacing: 1px;">REQUEST BODY</p>
                <pre class="mono glow-text" style="font-size: 0.85rem; white-space: pre-wrap;">{
  "count": 5,
  "prefix": "PROMO",
  "name": "Summer Sale",
  "uses_allowed": 1,
  "expires_days": 30
}</pre>
            </div>
        </div>
    </div>
</div>

<div class="cyber-card animate-in" style="margin-top: 1.5rem; animation-delay: 0.2s;">
    <div class="card-header">
        <h2 class="card-title">
            <span class="card-icon">◊</span>
            Code Examples
        </h2>
    </div>
    
    <div style="background: var(--dark-4); padding: 1.5rem; border-radius: 8px; border: 1px solid var(--glass-border);">
        <h4 style="color: var(--neon-green); margin-bottom: 1rem; font-family: 'Orbitron', sans-serif; font-size: 0.85rem;">// PYTHON</h4>
        <pre class="mono glow-text" style="font-size: 0.85rem; white-space: pre-wrap; background: var(--dark-2); padding: 1rem; border-radius: 6px;">import requests

response = requests.post(
    "{{ request.host_url }}api/validate",
    json={"code": "PROMO-ABCD-EFGH", "user_name": "John"}
)
print(response.json())</pre>
    </div>
    
    <div style="background: var(--dark-4); padding: 1.5rem; border-radius: 8px; margin-top: 1rem; border: 1px solid var(--glass-border);">
        <h4 style="color: var(--neon-cyan); margin-bottom: 1rem; font-family: 'Orbitron', sans-serif; font-size: 0.85rem;">// JAVASCRIPT</h4>
        <pre class="mono" style="color: var(--neon-cyan); font-size: 0.85rem; white-space: pre-wrap; background: var(--dark-2); padding: 1rem; border-radius: 6px;">const response = await fetch("{{ request.host_url }}api/validate", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ code: "PROMO-ABCD-EFGH" })
});
const data = await response.json();</pre>
    </div>
    
    <div style="background: var(--dark-4); padding: 1.5rem; border-radius: 8px; margin-top: 1rem; border: 1px solid var(--glass-border);">
        <h4 style="color: var(--warning); margin-bottom: 1rem; font-family: 'Orbitron', sans-serif; font-size: 0.85rem;">// CURL</h4>
        <pre class="mono" style="color: var(--warning); font-size: 0.85rem; white-space: pre-wrap; background: var(--dark-2); padding: 1rem; border-radius: 6px;">curl -X POST {{ request.host_url }}api/validate \
  -H "Content-Type: application/json" \
  -d '{"code": "PROMO-ABCD-EFGH"}'</pre>
    </div>
</div>
{% endblock %}
