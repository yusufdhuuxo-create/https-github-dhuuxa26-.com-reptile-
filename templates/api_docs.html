{% extends "base.html" %}

{% block title %}API Documentation - CodeVault{% endblock %}

{% block content %}
<div class="page-header">
    <h1>API Documentation</h1>
    <p>Integrate CodeVault with your applications</p>
</div>

<div class="glass-card animate-in">
    <div class="card-header">
        <h2 class="card-title">
            <span class="card-title-icon icon-purple">ðŸ”‘</span>
            API Key
        </h2>
    </div>
    {% if api_key %}
        <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 12px; margin-bottom: 1rem;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <code class="mono" style="color: var(--primary-light); font-size: 0.9rem;">{{ api_key.key[:8] }}...{{ api_key.key[-8:] }}</code>
                <div style="display: flex; gap: 0.5rem;">
                    <button class="btn btn-secondary btn-sm" onclick="copyToClipboard('{{ api_key.key }}', this)">ðŸ“‹ Copy</button>
                    <form method="POST" action="{{ url_for('regenerate_api_key') }}" style="display: inline;">
                        <button type="submit" class="btn btn-danger btn-sm">ðŸ”„ Regenerate</button>
                    </form>
                </div>
            </div>
            <p style="color: var(--text-muted); font-size: 0.85rem; margin-top: 0.75rem;">
                Created: {{ api_key.created_at.strftime('%Y-%m-%d %H:%M') }}
            </p>
        </div>
    {% else %}
        <form method="POST" action="{{ url_for('generate_api_key') }}">
            <button type="submit" class="btn btn-primary">ðŸ”‘ Generate API Key</button>
        </form>
    {% endif %}
</div>

<div class="glass-card animate-in" style="margin-top: 1.5rem; animation-delay: 0.1s;">
    <div class="card-header">
        <h2 class="card-title">
            <span class="card-title-icon icon-cyan">ðŸ“¡</span>
            Endpoints
        </h2>
    </div>
    
    <div style="display: flex; flex-direction: column; gap: 1.5rem;">
        <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 12px;">
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                <span class="badge badge-success">POST</span>
                <code class="mono" style="color: var(--text-primary);">/api/validate</code>
            </div>
            <p style="color: var(--text-secondary); margin-bottom: 1rem;">Validate and activate an activation code.</p>
            <div style="background: var(--bg-primary); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <p style="color: var(--text-muted); font-size: 0.8rem; margin-bottom: 0.5rem;">Request Body</p>
                <pre class="mono" style="color: var(--primary-light); font-size: 0.85rem; white-space: pre-wrap;">{
  "code": "PROMO-ABCD-EFGH",
  "user_name": "John Doe"  // optional
}</pre>
            </div>
            <div style="background: var(--bg-primary); padding: 1rem; border-radius: 8px;">
                <p style="color: var(--text-muted); font-size: 0.8rem; margin-bottom: 0.5rem;">Response</p>
                <pre class="mono" style="color: var(--success); font-size: 0.85rem; white-space: pre-wrap;">{
  "valid": true,
  "message": "Code activated successfully!",
  "data": { ... }
}</pre>
            </div>
        </div>
        
        <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 12px;">
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                <span class="badge badge-info">GET</span>
                <code class="mono" style="color: var(--text-primary);">/api/code/&lt;code&gt;/check</code>
            </div>
            <p style="color: var(--text-secondary); margin-bottom: 1rem;">Check if a code is valid without activating it.</p>
            <div style="background: var(--bg-primary); padding: 1rem; border-radius: 8px;">
                <p style="color: var(--text-muted); font-size: 0.8rem; margin-bottom: 0.5rem;">Response</p>
                <pre class="mono" style="color: var(--success); font-size: 0.85rem; white-space: pre-wrap;">{
  "exists": true,
  "valid": true,
  "message": "Code is valid",
  "uses_remaining": 1
}</pre>
            </div>
        </div>
        
        <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 12px;">
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                <span class="badge badge-info">GET</span>
                <code class="mono" style="color: var(--text-primary);">/api/stats</code>
            </div>
            <p style="color: var(--text-secondary); margin-bottom: 1rem;">Get overall statistics about activation codes.</p>
            <div style="background: var(--bg-primary); padding: 1rem; border-radius: 8px;">
                <p style="color: var(--text-muted); font-size: 0.8rem; margin-bottom: 0.5rem;">Response</p>
                <pre class="mono" style="color: var(--success); font-size: 0.85rem; white-space: pre-wrap;">{
  "total": 100,
  "active": 75,
  "used": 20,
  "inactive": 5,
  "usage_rate": 20.0
}</pre>
            </div>
        </div>
        
        <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 12px;">
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                <span class="badge badge-success">POST</span>
                <code class="mono" style="color: var(--text-primary);">/api/generate</code>
            </div>
            <p style="color: var(--text-secondary); margin-bottom: 1rem;">Generate new activation codes (requires API key in header).</p>
            <div style="background: var(--bg-primary); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <p style="color: var(--text-muted); font-size: 0.8rem; margin-bottom: 0.5rem;">Headers</p>
                <pre class="mono" style="color: var(--warning); font-size: 0.85rem;">X-API-Key: your_api_key_here</pre>
            </div>
            <div style="background: var(--bg-primary); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <p style="color: var(--text-muted); font-size: 0.8rem; margin-bottom: 0.5rem;">Request Body</p>
                <pre class="mono" style="color: var(--primary-light); font-size: 0.85rem; white-space: pre-wrap;">{
  "count": 5,
  "prefix": "PROMO",
  "name": "Summer Sale",
  "uses_allowed": 1,
  "expires_days": 30
}</pre>
            </div>
            <div style="background: var(--bg-primary); padding: 1rem; border-radius: 8px;">
                <p style="color: var(--text-muted); font-size: 0.8rem; margin-bottom: 0.5rem;">Response</p>
                <pre class="mono" style="color: var(--success); font-size: 0.85rem; white-space: pre-wrap;">{
  "success": true,
  "codes": ["PROMO-ABCD-EFGH", ...]
}</pre>
            </div>
        </div>
    </div>
</div>

<div class="glass-card animate-in" style="margin-top: 1.5rem; animation-delay: 0.2s;">
    <div class="card-header">
        <h2 class="card-title">
            <span class="card-title-icon icon-green">ðŸ’»</span>
            Code Examples
        </h2>
    </div>
    
    <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 12px;">
        <h4 style="color: var(--text-primary); margin-bottom: 1rem;">Python</h4>
        <pre class="mono" style="color: var(--primary-light); font-size: 0.85rem; white-space: pre-wrap; background: var(--bg-primary); padding: 1rem; border-radius: 8px;">import requests

response = requests.post(
    "{{ request.host_url }}api/validate",
    json={"code": "PROMO-ABCD-EFGH", "user_name": "John"}
)
print(response.json())</pre>
    </div>
    
    <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 12px; margin-top: 1rem;">
        <h4 style="color: var(--text-primary); margin-bottom: 1rem;">JavaScript</h4>
        <pre class="mono" style="color: var(--primary-light); font-size: 0.85rem; white-space: pre-wrap; background: var(--bg-primary); padding: 1rem; border-radius: 8px;">const response = await fetch("{{ request.host_url }}api/validate", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ code: "PROMO-ABCD-EFGH", user_name: "John" })
});
const data = await response.json();
console.log(data);</pre>
    </div>
    
    <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 12px; margin-top: 1rem;">
        <h4 style="color: var(--text-primary); margin-bottom: 1rem;">cURL</h4>
        <pre class="mono" style="color: var(--primary-light); font-size: 0.85rem; white-space: pre-wrap; background: var(--bg-primary); padding: 1rem; border-radius: 8px;">curl -X POST {{ request.host_url }}api/validate \
  -H "Content-Type: application/json" \
  -d '{"code": "PROMO-ABCD-EFGH", "user_name": "John"}'</pre>
    </div>
</div>
{% endblock %}
